if command -v tmux &> /dev/null && [ -n "$PS1" ] \
    && [[ ! "$TERM" =~ screen ]] \
    && [[ ! "$TERM" =~ tmux ]] \
    && [ -z "$TMUX" ]; then
    exec tmux
fi

set -U EDITOR nvim
export EDITOR='nvim'
export VISUAL='nvim'
export PATH="$HOME/.npm/bin:$PATH"

export DENO_INSTALL="/home/master/.deno"
export PATH="$DENO_INSTALL/bin:$PATH"
export PATH="$HOME/.gem/ruby/2.7.0/bin:$PATH"
export PATH="$HOME/.local/share/gem/ruby/3.0.0/bin:$PATH"
export PATH="$HOME/gems/bin:$PATH"
export PATH="$PATH:/opt/mssql-tools/bin"
export PATH=$PATH:~/.local/bin
export GEM_HOME="$HOME/gems"

zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*' rehash true
zstyle ':completion:*' accept-exact '*(N)'
WORDCHARS=${WORDCHARS//\/[&.;]}

autoload -U colors && colors
eval "$(starship init zsh)"

setopt histignorealldups sharehistory
setopt EXTENDED_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_FIND_NO_DUPS
setopt HIST_SAVE_NO_DUPS
setopt HIST_BEEP
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.zsh_history

bindkey -v

function zle_keymap_select {
if [[ ${KEYMAP} == vicmd ]] ||
    [[ $1 = 'block' ]]; then
    echo -ne '\e[1 q'
elif [[ ${KEYMAP} == main ]] ||
    [[ ${KEYMAP} == viins ]] ||
    [[ ${KEYMAP} = '' ]] ||
    [[ $1 = 'beam' ]]; then
    echo -ne '\e[5 q'
fi
}

zle -N zle_keymap_select

function zle_line_init() {
    zle -K viins
    echo -ne "\e[5 q"
}

zle -N zle_line_init

echo -ne '\e[5 q'

preexec() { echo -ne '\e[5 q' ;}

autoload -Uz compinit
compinit

function downloadFile () {
    cd ~/Downloads
    aria2c $argv
    ls -lah ~/Downloads
    cd -
}

function cppProject () {
    cp -r ~/.config/nvim/stuff/cpppro/* .
    nvim -p main.cpp source.cpp header.h
}

prettierCpp () { clang-format --style=Google -i $(find -name '*.h' && find -name '*.cpp') }

prettierCs () { clang-format --style=Google -i $(find -name '*.cs') }

function repeatIn1s () {
    while true
    do
        $argv
        sleep 1
    done
}

function mk () {
    if [ ! -n "$1" ]; then
        echo "Enter a directory name"
    elif [ -d $1 ]; then
        echo "\`$1' already exists"
        cd $1
    else
        mkdir -p $1 && cd $1
    fi
}

SERVER_IP () { hostname -I }

se () { browser-sync start --server --files . --no-notify --host SERVER_IP --port 9000 }

alias l='exa -al --color=always --group-directories-first --icons'
alias ls='exa -al --color=always --group-directories-first --icons'
alias sl='exa -al --color=always --group-directories-first --icons'
alias la='exa -a --color=always --group-directories-first --icons'
alias al='exa -a --color=always --group-directories-first --icons'
alias l.='exa -a| egrep "^\."'
alias ll='exa -l --color=always --group-directories-first --icons'
alias lt='exa -aT --color=always --group-directories-first --icons'

alias cpf='wl-copy'
alias reload='source ~/.zshrc ; tmux source-file ~/.tmux.conf'
alias h='htop'
alias e='exit'
alias :q='exit'
alias q='exit'
alias p='ipython3'
alias ka='killall'
alias v='nvim -c "Files"'
alias 777='chmod -R 777'
alias x='chmod +x'
alias colorPicker='zenity --color-selection'
alias cat='batcat'
export GREP_COLOR='1;31'
alias grep='grep --color=auto'
alias n='nnn -de'
alias dud='du -d 1 -h'
# alias gn='cd ~/sync/note/ ; nvim -c "NumberLineOff" -c "Rg" README.md'
alias shit='sudo $(fc -ln -1)'

# music stuff
alias m='mpv --shuffle --loop-playlist ~/Music/*'

# ubuntu apt
alias ins='sudo apt install -y'
alias uins='sudo apt remove -y'

# termux pkg
# alias ins='pkg install -y'
# alias uins='pkg remove -y'

# fedora dnf
# alias ins='sudo dnf -y install'
# alias uins='sudo dnf -y remove'

# arch
# alias ins='sudo pacman -S --noconfirm'
# alias ins2='yay -S --noconfirm'
# alias uins='sudo pacman -Rs --noconfirm'

alias ide='tmux split-window -v -p 20 ; tmux split-window -h -p 50 ; tmux last-pane ; nvim'
# alias ide='tmux split-window -v -p 8 ; tmux last-pane ; nvim'
# alias ide='tmux split-window -h -p 30 ; tmux split-window -v -p 75 ; tmux last-pane ; nvim'

function killAllUnnameTmuxSession() {
    cowsay "kill all unname tmux session"
    tmux ls | awk '{print $1}' | grep -o '[0-9]\+' >> ok.sh
    sed -i 's/^/tmux kill-session -t /' ok.sh
    chmod +x ok.sh
    ./ok.sh
    rm ok.sh
    tmux ls
}
alias qa="killAllUnnameTmuxSession"

alias ..='cd .. ; l'
alias ...='cd .. ; cd .. ; l'
alias dow='cd ~/Downloads ; l'
alias tmp='cd /tmp ; l'

alias yt='youtube-dl -f bestvideo+bestaudio'
alias yta='youtube-dl -f "bestaudio" --continue --no-overwrites --ignore-errors --extract-audio --audio-format mp3 -o "%(title)s.%(ext)s"'

function musicSync() {
    cd ~/Music/
    trash *
    yta "https://thuanpham2311.github.io/l/music"
}

alias t='trash'
alias tdl='trash ~/Downloads/*'

function nvm() {
    echo "ðŸš¨ NVM not loaded! Loading now..."
    unset -f nvm
    export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    nvm "$@"
}

function updateHostsBlockShit() {
    sudo curl https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling/hosts --output /etc/hosts
    cowsay "sometimes if you not lazy try to clear host cache: chrome://net-internals/#dns"
    sudo systemctl restart NetworkManager.service
}

function update () {
    nvim -c "PlugUpdate | qa"
    nvim -c "CocUpdateSync | qa"
    npm update -g
    npm install -g npm
    gem update neovim
    tldr --update
    gh extension upgrade --all
    updateHostsBlockShit
    ~/.tmux/plugins/tpm/bin/update_plugins all
    flatpak update -y

    # arch base
    # sudo pacman -Syu --noconfirm
    # yay -Sua --noconfirm

    # debian base (ubuntu, kali,...)
    sudo apt update
    sudo apt upgrade -y
    sudo apt autoremove -y
    sudo apt autoclean

    # rehat base (fedora)
    # sudo dnf update -y
    # sudo dnf autoremove -y
}

function hi () {
    qa
    browserDaily
    sleep 30
    update
    neofetch
    cowsay "internet speed"
    speedtest-cli
    cowsay "github habit"
    gh graph --pixel %EF%90%88%20 --scheme github
    nvim -p ~/sync/note/*.md
}

source ~/dotfiles/zsh/functions/themeControl.zsh
source ~/dotfiles/zsh/functions/browserConfig.zsh
source ~/dotfiles/zsh/functions/gitConfig.zsh
source ~/dotfiles/zsh/functions/completion.zsh
source ~/dotfiles/zsh/functions/fzfConfig.zsh
source ~/dotfiles/zsh/functions/fzfKeyBindings.zsh
source ~/dotfiles/zsh/functions/vpn.zsh
source ~/dotfiles/zsh/functions/zshAutoSuggestions.zsh
source ~/dotfiles/zsh/functions/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source ~/dotfiles/zsh/functions/commandStartupShell.zsh
